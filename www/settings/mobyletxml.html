<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>mobylet（モビレット） | 設定ファイル（mobylet.xml） | 携帯Webアプリケーションを開発するためのJavaオープンソースフレームワーク</title>
<meta http-equiv="Content-Language" content="ja" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta http-equiv="Content-Script-Type" content="text/javascript" />
<meta name="description" content="「mobylet」はJavaで作られたオープンソースのモバイルWebアプリケーションフレームワークで、様々なWebフレームワークと共に利用することが可能です。" />
<meta name="keywords" content="携帯,モバイル,Web,Java,OSS,絵文字,mobylet" />
<script src="../js/rollover.js" type="text/javascript"></script>
<link href="../css/style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<!-- ↓wrapperArea -->

<div id="wrapper">
<!-- ↓headerArea -->
	<div id="header" class="container">
		<h1><a id="logo" href="../index.html" title="mobylet">mobylet</a></h1>
	</div>
<!-- ↑headerArea -->
<!-- ↓glovalNaviArea -->
	<div id="globalNavi" class="container">
		<ul id="mainmenu" class="container">
			<li><a href="../guides/"><img src="../img/globalnavi/bg.gif" alt="初めての方へ" title="初めての方へ" class="imgover"/></a></li>
			<li><img src="../img/globalnavi/st_o.gif" alt="mobyletの設定" title="mobyletの設定" /></li>
			<li><a href="../references/"><img src="../img/globalnavi/ft.gif" alt="機能リファレンス" title="機能リファレンス" class="imgover"/></a></li>
			<li><a href="../downloads/"><img src="../img/globalnavi/dl.gif" alt="ダウンロード" title="ダウンロード" class="imgover"/></a></li>
			<li><a href="https://www.seasar.org/issues/browse/MOBYLET" target="_blank"><img src="../img/globalnavi/jr.gif" alt="JIRA" title="JIRA" class="imgover"></a></li>
			<li><a href="../informations/"><img src="../img/globalnavi/if.gif" alt="インフォメーション" title="インフォメーション" class="imgover"/></a></li>
			<li><a href="http://blog.livedoor.jp/mobylet/" target="_blank"><img src="../img/globalnavi/bl.gif" alt="ブログ" title="ブログ" class="imgover"></a></li>
		</ul>
	</div>
<!-- ↑glovalNaviArea -->
<!-- ↓contentsArea -->
	<div id="contents" class="container">
		<div id="leftcontents">
			<div id="uppercontents">

<h2 class="green">mobylet.xml</h2>
<p>
mobyletの基本的な設定は、全て「mobylet.xml」という設定ファイルに記述します。<br />
「mobylet.xml」には、主に以下のような設定を記述します。
</p>
<ol class="ts bs lm">
	<li>mobylet内部コンポーネント初期化</li>
	<li>外部ファイル読み込み時のディレクトリ指定</li>
</ol>
<p>
以下、mobylet.xmlのサンプルとなります。<br />
（mobylet-core-xxx.jarに含まれているファイルです）
</p>
<pre class="code">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;mobylet&gt;
    &lt;initializers&gt;
        &lt;chain&gt;org.mobylet.core.initializer.impl.MobyletInitializerImpl&lt;/chain&gt;
    &lt;/initializers&gt;
    &lt;device&gt;
        &lt;basedir&gt;device/&lt;/basedir&gt;
    &lt;/device&gt;
    &lt;emoji&gt;
        &lt;basedir&gt;emoji/&lt;/basedir&gt;
    &lt;/emoji&gt;
&lt;/mobylet&gt;
</pre>
<p>
「mobylet.xml」は、Webアプリケーション単位に用意されなかった場合<br />
mobylet-core-xxx.jarに含まれているmobylet.xmlを読み込むことで初期化を行いまが<br />
Webアプリケーション単位にファイルが用意されている場合は、そちらを優先して読み込みます。<br />
<br />
「mobylet.xml」を配置するディレクトリはデフォルトでクラスパス上となりますが<br />
MobyletFilterのInitParameterに指定することで、任意の位置の「mobylet.xml」を使用することも可能です。<br />
以下、「mobylet.xml」を読み込むディレクトリを設定した例です。<br />
（※クラスパスからの相対パス指定も可能）
</p>
<pre class="code">
&lt;filter&gt;
    &lt;filter-name&gt;mobyletfilter&lt;/filter-name&gt;
    &lt;filter-class&gt;org.mobylet.core.http.MobyletFilter&lt;/filter-class&gt;
    &lt;init-param&gt;
        &lt;param-name&gt;mobylet.config.dir&lt;/param-name&gt;
        &lt;param-value&gt;/var/mobylet/config/&lt;/param-value&gt;
    &lt;/init-param&gt;
&lt;/filter&gt;
</pre>

<h3 class="green">mobylet内部コンポーネント初期化</h3>
<p>
mobyletは内部にSingleton-Scope/Request-Scopeの簡易的なコンテナを持っています。<br />
このコンテナに登録するコンポーネントを初期化する際、<br />
MobyletInitializerインターフェースを実装したクラスを初期化時に走らせることで<br />
各種コンポーネントを初期化しています。<br />
<br />
以下のように&lt;inilializers&gt;タグ内に&lt;chain&gt;タグで、複数の初期化クラスを指定できます。<br />
&lt;chain&gt;タグは上から順番に読み込み、初期化処理を行います。<br />
デフォルトで指定されている「org.mobylet.core.initializer.impl.MobyletInitializerImpl」クラスは<br />
mobyletフレームワーク内部を初期化するためのクラスですので、このクラスの指定は削除しないでください。<br />
<br />
例えばmobylet-mailを利用するためにはmobylet-mailに対しての初期化を行う必要があるため<br />
以下のように初期化クラスを指定することになります。<br />
</p>
<pre class="code">
&lt;initializers&gt;
    &lt;chain&gt;org.mobylet.core.initializer.impl.MobyletInitializerImpl&lt;/chain&gt;
    &lt;chain&gt;org.mobylet.mail.initializer.MobyletMailInitializer&lt;/chain&gt;
&lt;/initializers&gt;
</pre>
<p>
mobyletフレームワークを拡張する際や、コンポーネントを変更したい場合は<br />
初期化クラスを別途実装し、chainに指定することで、フレームワークの内部の動作を変更することが可能です。
</p>



<p>
■ その他の方<br />
<br />
以下のページから最新バージョンのライブラリを取得し<br />
プロジェクトに展開、及び適用（WEB-INF/libディレクトリなどに配置）してください。
</p>
<ul class="ts bs lm">
	<li><a href="../downloads/">mobyletライブラリダウンロードページ</a></li>
</ul>

<h3 class="green">MobyletFilterを適用する</h3>
<p>
web.xmlに以下の設定を行います。
</p>
<pre class="code">
&lt;filter&gt;
    &lt;filter-name&gt;mobyletfilter&lt;/filter-name&gt;
    &lt;filter-class&gt;org.mobylet.core.http.MobyletFilter&lt;/filter-class&gt;
&lt;/filter&gt;

&lt;filter-mapping&gt;
    &lt;filter-name&gt;mobyletfilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;
</pre>
<p>
このMobyletFilterはパラメータやレスポンスのエンコード/デコード処理などを行っているため、<br />
必ずFilterChainの最初に適用するようにしてください。<br />
（※filter-mappingの最初に記述されていれば問題ありません）<br />
</p>
<p class="ts">
他のフレームワークを併用する場合、既にエンコード用のFilterなどが存在する場合がありますが<br />
その場合はエンコード用のFilterを外して、MobyletFilterを代わりに使用して下さい。
</p>

<h3 class="green">文字コードの設定</h3>
<p>
まずは以下のページから最新の文字コードライブラリ（mobylet-charset.jar）を取得します。
</p>
<ul class="ts bs lm">
	<li><a href="../downloads/">mobyletライブラリダウンロードページ</a></li>
</ul>
<p>
mobyletの文字コードを利用するために<br />
以下のディレクトリにライブラリを配置します。
</p>
<pre class="code">
{JREホームディレクトリ}/lib/ext/
</pre>
<p>
インフラの都合などにより、上記のディレクトリにライブラリを配置することが困難な場合、<br />
JVMパラメータの「-Djava.ext.dirs」を指定することにより<br />
任意のディレクトリに配置した文字コードライブラリを利用することが可能です。
</p>
<p class="ts">
以下、Tomcatの場合の設定例を記述します。
</p>
<p class="ts">
■ Windowsの場合<br />
<br />
Tomcatのbinディレクトリにあるsetenv.batに以下の記述を追加します。
</p>
<pre class="code">
set CATALINA_OPTS=-Djava.ext.dirs=${mobylet-charset-xxx.jarを配置したディレクトリ}
</pre>
<p class="ts">
■ Linuxの場合<br />
<br />
Tomcatのbinディレクトリにあるsetenv.shに以下の記述を追加します。
</p>
<pre class="code">
CATALINA_OPTS=-Djava.ext.dirs=${mobylet-charset-xxx.jarを配置したディレクトリ}
</pre>
<p class="ts">
■ Eclipseで動作させる場合<br />
<br />
<a href="../guides/">「初めての方へ」</a>の内容に沿って、GUI上で設定してください。
</p>

<h3 class="green">最新の端末情報を取得する（バリューエンジン社提供）</h3>
<p>
mobyletは<a href="http://valueengine.jp/" target="_blank">バリューエンジン社</a>が無償提供している<br />
端末プロファイル情報をデフォルトでサポートしています。<br />
（バリューエンジン社の許諾も頂いております）<br />
<br />
<a href="http://valueengine.jp/" target="_blank">バリューエンジン社</a>のホームページから最新版のプロファイル情報（CSVデータ）をダウンロードし、<br />
以下のようにリネームしてください。
</p>
<pre class="code">
ProfileData_YYYY-MM-DD.csv → ProfileData.csv
UserAgent_YYYY-MM-DD.csv → UserAgent.csv
DisplayInfo_YYYY-MM-DD.csv → DisplayInfo.csv
</pre>
<p>
リネームした3種類のファイルをクラスパス上のdeviceディレクトリ（作成する）配下に配置してください。<br />
例） Maven2を利用したプロジェクトの場合
</p>
<pre class="code">
{projectディレクトリ}/src/main/resources/device/
</pre>
<p>
例） 通常のWebアプリケーションプロジェクトの場合
</p>
<pre class="code">
{webappルート}/WEB-INF/classes/device/
</pre>
<p>
端末プロファイル情報を配置するディレクトリは、mobylet.xmlファイルに記述することで変更することも可能です。
</p>

<h3 class="green">taglibの利用設定（任意）</h3>
<p>
ViewにJSPを利用される場合は、便利なtaglibライブラリがあります。<br />
既にダウンロードしたライブラリの中に「mobylet-taglibs-xxx.jar」が入っていると思いますので<br />
JSPの上部に以下のpageディレクティブを記述することで、mobyletが提供するtaglibをご利用いただけます。
</p>
<pre class="code">
&lt;%@ taglib prefix="m" uri="http://taglibs.mobylet.org/" %&gt;
</pre>

			</div>
			<div id="undercontents">
			</div>
		</div>
		<div id="rightcontents">
			<div class="submenu">
				<h4>Settings</h4>
				<ul class="menu">
					<li><a href="index.html">mobyletの設定</a></li>
					<li>mobylet.xml</li>
					<li>メール設定</li>
				</ul>
				<h4 class="ts">Tutorials</h4>
				<ul class="menu">
					<li>Simple Version（JSP only）</li>
					<li>SAStruts Version</li>
					<li>GAE/J Version</li>
				</ul>
			</div>
		</div>
	</div>
<!-- ↑contentsArea -->
<!-- ↓footerArea -->
	<div id="footer">
		<div id="copyright">
			&copy; Copyright The Seasar Foundation and the others 2006, all rights reserved.<br/>
			constructed by <a href="http://www.leihauoli.com/" title="株式会社レイハウオリ">株式会社Lei Hau'oli</a><br/>
			supported by <a href="http://valueengine.jp/" title="株式会社バリューエンジン">株式会社バリューエンジン</a>
		</div>
	</div>
<!-- ↑footerArea -->
</div>
<!-- ↑wrapperArea -->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-9308763-1");
pageTracker._trackPageview();
} catch(err) {}</script>
</body>
</html>
